## 位运算的基础操作

基本的位运算符有与、或、异或、取反、左移、右移这6中，它们的运算规则如下：

|符号|描述|运算规则|
|------|---------|------------------------|
|&|与|两个位数都为1，结果才为1|
|丨|或|两个位数都为0，结果才为0|
|^|异或|两个位数相同为0，不同为1|
|-|取反|0变1,1变0|
|<<|左移|各二进位全部左移若干位，高位丢弃，低位补0|
|>>|右移|各二进位全部右移若干位，对无符号，高位补0；有符号数，各编译器处理方法不一样，有的补符号位（算数右移），有的补0（逻辑右移）|

注意：

- 在这6种操作符，只有~取反是单目操作符，其它5种都是双目操作符。
- 位操作只能用于整形数据，对float和double类型进行位操作会被编译器报错。
- 位操作符的运算优先级比较低，因为尽量使用括号来确保运算顺序，否则很可能会得到莫明其妙的结果。比如要得到像1，3，5，9这些2^i+1的数字。写成`int a = 1 << i + 1`;是不对的，程序会先执行i + 1，再执行左移操作。应该写成`int a = (1 << i) + 1`;
- 另外位操作还有一些复合操作符，如`&=、|=、 ^=、<<=、>>=。`

### **位运算的小技巧**

下边对位运算的一些常见应用做个总结，有判断奇偶、交换两数、变换符号以及求绝对值。

**判断奇偶**
只要根据最末位是0还是1来判断就好。为0就是偶数，为1就是奇数。因此可以用if((a&1)==0)代替if(a%2==0)来判断a是不是偶数。

下边的程序输出0到100之间的所有奇数

```
for (i = 0; i < 100; ++i)  
    if (i & 1)  
        printf("%d ", i);  
putchar('\n'); 

```

**交换两数**

一般的写法：

```
void Swap(int &a, int &b)  
{  
    if (a != b)  
    {  
        int c = a;  
        a = b;  
        b = c;  
    }  
}  
```

可以用位运算来实现交换两数而不用第三方变量：

```
void Swap(int &a, int &b)  
{  
    if (a != b)  
    {  
        a ^= b;  
        b ^= a;  
        a ^= b;  
    }  
}  
 
```
我们可以这样理解：
- 第一步 a^=b 即a=(a^b);
- 第二步 b^=a 即b=b^(a^b)，由于^运算满足交换律，b^(a^b)=b^b^a。由于一个数和自己异或的结果为0并且任何数与0异或都会不变的，所以此时b被赋上了a的值。
- 第三步 a^=b 就是a=a^b，由于前面二步可知a=(a^b)，b=a，所以a=a^b即a=(a^b)^a。故a会被赋上b的值。

再来个实例说明下以加深印象。int a = 13, b = 6;
a的二进制为 13=8+4+1=1101(二进制)
b的二进制为 6=4+2=110(二进制)

- 第一步 a^=b a = 1101 ^ 110 = 1011;
- 第二步 b^=a b = 110 ^ 1011 = 1101;即b=13
- 第三步 a^=b a = 1011 ^ 1101 = 110;即a=6

**求绝对值**

位操作也可以用来求绝对值，正数就直接是它本身，对于负数可以通过对其取反后加1来得到正数。
先移位来取符号位，`int i = a >> 31`;要注意如果a为正数，i等于0，为负数，i等于-1。然后对i进行判断——如果i等于0，直接返回。否之，返回~a+1。完整代码如下：

```
int my_abs(int a)  
{  
    int i = a >> 31;  
    return i == 0 ? a : (~a + 1);  
}  
 
```

现在再分析下。对于任何数，与0异或都会保持不变，与-1即0xFFFFFFFF异或就相当于取反。因此，a与i异或后再减i（因为i为0或-1，所以减i即是要么加0要么加1）也可以得到绝对值。所以可以对上面代码优化下：

```
int my_abs(int a)  
{  
    int i = a >> 31;  
    return ((a ^ i) - i);  
}  
```